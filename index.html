<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MonitoringPV</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
  <style>
    .param-card {
      width: 6rem;
      height: 6rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background-color: white;
      border-radius: 1rem;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      transition: transform 0.3s;
    }
    .param-card:hover {
      transform: scale(1.05);
    }
    @media (min-width: 640px) {
      .param-card {
        width: 7rem;
        height: 7rem;
      }
    }
    @media (min-width: 768px) {
      .param-card {
        width: 8rem;
        height: 8rem;
      }
    }
    #water {transition: stroke-dashoffset 0.5s ease;}
    #container {
      position: relative;
      width: 150px;
      height: 150px;
      margin: auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    #emoji {
      font-size: 2rem;
      color: rgb(255, 85, 0);
      z-index: 10;
    }
    #valueDisplay {
      font-weight: bold;
      font-size: 1rem;
      z-index: 10;
    }
    #kondisiCuaca {
      font-size: 0.875rem; /* text-sm */
      color: #4B5563; /* gray-600 */
      margin-top: 0.25rem; /* mt-1 */
      z-index: 10;
    }
    #clock {
      font-size: 0.875rem;
      color: #6B7280; /* gray-500 */
      margin-top: 0.25rem;
      z-index: 10;
    }
    #rumahPenelitian {
      font-size: 0.875rem;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 0.25rem;
      margin-top: 0.25rem;
      z-index: 10;
      text-align: center;
    }
  </style>
</head>
  <body class="bg-white min-h-screen text-gray-900 font-sans flex flex-col">
    <header class="fixed top-0 left-0 w-full z-50 bg-white/40 backdrop-blur-xl border-b border-white/20 shadow-lg">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16 sm:h-20">
          <div class="flex items-center gap-3 flex-wrap">
            <img src="assets/images/drpm.png" alt="Logo DRPM" class="h-14 w-14 sm:h-20 sm:w-20 object-contain">
            <img src="assets/images/untad.png" alt="Logo Untad" class="h-5 w-5 sm:h-8 sm:w-8 object-contain">
            <div>
              <h1 class="text-base sm:text-xl md:text-2xl font-bold text-gray-800 tracking-tight">Sistem Monitoring</h1>
              <p class="text-xs sm:text-sm text-gray-500">Universitas Tadulako</p>
            </div>
          </div>
          <nav class="hidden md:flex items-center gap-8">
            <button onclick="showPage('utama', this)" class="nav-link px-3 py-2 rounded-lg text-gray-600 hover:text-blue-600 hover:bg-blue-50 transition">Utama</button>
            <button onclick="showPage('grafik', this)" class="nav-link px-3 py-2 rounded-lg text-gray-600 hover:text-blue-600 hover:bg-blue-50 transition">Grafik</button>
            <button onclick="showPage('histori', this)" class="nav-link px-3 py-2 rounded-lg text-gray-600 hover:text-blue-600 hover:bg-blue-50 transition">Histori</button>
          </nav>
          <div class="md:hidden">
            <button id="menuBtn" class="focus:outline-none text-xl text-gray-700 hover:text-blue-600 transition-colors duration-300">☰</button>
          </div>
        </div>
      </div>
      <div id="mobileMenu" class="hidden md:hidden absolute top-20 inset-x-0 bg-white/95 backdrop-blur-xl border-t border-gray-200 shadow-lg animate-slide-down">
        <nav class="flex flex-col px-6 py-4 space-y-4">
          <button onclick="showPage('utama', this)" class="nav-link text-left">Utama</button>
          <button onclick="showPage('grafik', this)" class="nav-link text-left">Grafik</button>
          <button onclick="showPage('histori', this)" class="nav-link text-left">Histori</button>
        </nav>
      </div>
    </header>
    <div class="flex-1 pt-24">
      <div id="utama">
        <div class="flex flex-col items-center">
          <h2 class="text-center font-bold text-blue-600 mb-4">Manajemen Energi Pada Rumah Tropis SSRPV Berbasis Iklim Mikro Menggunakan Pendekatan Eksperimental dan Artificial Neural Network</h2>
          <div id="container" class="relative w-40 h-40 flex flex-col items-center justify-center">
            <svg id="hoseSvg" width="100%" height="100%" viewBox="0 0 200 200" class="absolute top-0 left-0">
              <circle id="water" cx="100" cy="100" r="60"
                stroke="deepskyblue" stroke-width="15" fill="none"
                stroke-linecap="round"
                transform="rotate(140 100 100)" />
            </svg>
            <div id="emoji" class="text-4xl text-orange-500 z-10"><i class="fas fa-temperature-half"></i></div>
            <div id="valueDisplay" class="font-bold text-lg z-10">-</div>
            <div id="kondisiCuaca" class="text-sm text-gray-600 z-10 mt-1">-</div>
            <span id="clock" class="text-sm text-gray-500 mt-1 z-10"></span>
            <h3 class="relative z-50">
              <a href="https://maps.app.goo.gl/QdtRZ6RYMNWyHMBPA"
                target="_blank"
                id="rumahPenelitian"
                class="text-blue-600 hover:underline">
                <i class="fas fa-map-marker-alt text-red-500"></i> Rumah Penelitian
              </a>
            </h3>
          </div>
        </div>
        <div class="flex flex-wrap justify-center gap-4 p-4">
          <div class="param-card">
            <div class="mb-1"><i class="fas fa-thermometer-half text-orange-400"></i></div>
            <div class="text-sm sm:text-base md:text-lg font-semibold" id="suhu1">- °C</div>
            <div class="text-xs sm:text-sm text-gray-500">Suhu Mono</div>
          </div>
          <div class="param-card">
            <div class="mb-1"><i class="fas fa-tint text-blue-100"></i></div>
            <div class="text-sm sm:text-base md:text-lg font-semibold" id="kelembaban1">- %</div>
            <div class="text-xs sm:text-sm text-gray-500">RH Mono</div>
          </div>
          <div class="param-card">
            <div class="mb-1"><i class="fas fa-thermometer-half text-orange-500"></i></div>
            <div class="text-sm sm:text-base md:text-lg font-semibold" id="suhu2">- °C</div>
            <div class="text-xs sm:text-sm text-gray-500">Suhu Poly</div>
          </div>
          <div class="param-card">
            <div class="mb-1"><i class="fas fa-tint text-blue-200"></i></div>
            <div class="text-sm sm:text-base md:text-lg font-semibold" id="kelembaban2">- %</div>
            <div class="text-xs sm:text-sm text-gray-500">RH Poly</div>
          </div>
          <div class="param-card">
            <div class="mb-1"><i class="fas fa-wind text-gray-200"></i></div>
            <div class="text-sm sm:text-base md:text-lg font-semibold" id="kecepatan_angin">- m/s</div>
            <div class="text-xs sm:text-sm text-gray-500">Kecepatan Angin</div>
          </div>
          <div class="param-card">
            <div class="mb-1"><i class="fas fa-compass text-gray-300"></i></div>
            <div class="text-sm sm:text-base md:text-lg font-semibold" id="arah_angin">-</div>
            <div class="text-xs sm:text-sm text-gray-500">Arah Angin</div>
          </div>
          <div class="param-card">
            <div class="mb-1"><i class="fas fa-sun text-yellow-300"></i></div>
            <div class="text-sm sm:text-base md:text-lg font-semibold" id="uv_index">-</div>
            <div class="text-xs sm:text-sm text-gray-500">UV Index</div>
          </div>
          <div class="param-card">
            <div class="mb-1"><i class="fas fa-sun text-yellow-400"></i></div>
            <div class="text-sm sm:text-base md:text-lg font-semibold" id="uv_intensity">-</div>
            <div class="text-xs sm:text-sm text-gray-500">UV Intensity</div>
          </div>
          <div class="param-card">
            <div class="mb-1"><i class="fas fa-sun text-yellow-500"></i></div>
            <div class="text-sm sm:text-base md:text-lg font-semibold" id="irradiance">-</div>
            <div class="text-xs sm:text-sm text-gray-500">Radiasi Matahari</div>
          </div>
          <div class="param-card">
            <div class="mb-1"><i class="fas fa-smog text-gray-400"></i></div>
            <div class="text-sm sm:text-base md:text-lg font-semibold" id="debu">- µg/m³</div>
            <div class="text-xs sm:text-sm text-gray-500">Debu</div>
          </div>
          <div class="param-card">
            <div class="mb-1"><i class="fas fa-cloud-showers-heavy text-blue-400"></i></div>
            <div class="text-sm sm:text-base md:text-lg font-semibold" id="curah_hujan">- mm</div>
            <div class="text-xs sm:text-sm text-gray-500">Curah Hujan</div>
          </div>
        </div>
      </div>
      <div id="grafik" class="hidden">
        <div class="p-4 grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="p-4 bg-white rounded-2xl shadow-lg">
            <h2 class="text-lg font-semibold mb-2 text-gray-800">Suhu</h2>
            <canvas id="chartSuhu"></canvas>
          </div>
          <div class="p-4 bg-white rounded-2xl shadow-lg">
            <h2 class="text-lg font-semibold mb-2 text-gray-800">Kelembaban</h2>
            <canvas id="chartKelembaban"></canvas>
          </div>
          <div class="p-4 bg-white rounded-2xl shadow-lg">
            <h2 class="text-lg font-semibold mb-2 text-gray-800">Kecepatan Angin</h2>
              <canvas id="chartAngin"></canvas>
            </div>
            <div class="p-4 bg-white rounded-2xl shadow-lg flex flex-col items-center">
              <h2 class="text-xl font-semibold mb-4 text-gray-800">Arah Angin</h2>
              <canvas id="compass" width="360" height="360"></canvas>
              <div id="windInfo" class="mt-4 text-center">
                <p class="text-lg font-medium text-gray-900" id="chartArahAngin">-</p>
              </div>
            </div>
            <div class="p-4 bg-white rounded-2xl shadow-lg">
              <h2 class="text-lg font-semibold mb-2 text-gray-800">Sinar UV</h2>
              <canvas id="chartUV"></canvas>
          </div>
          <div class="p-4 bg-white rounded-2xl shadow-lg">
            <h2 class="text-lg font-semibold mb-2 text-gray-800">Radiasi Matahari</h2>
            <canvas id="chartRadiasi"></canvas>
          </div>
          <div class="p-4 bg-white rounded-2xl shadow-lg">
            <h2 class="text-lg font-semibold mb-2 text-gray-800">Debu</h2>
            <canvas id="chartDebu"></canvas>
          </div>
          <div class="p-4 bg-white rounded-2xl shadow-lg">
            <h2 class="text-lg font-semibold mb-2 text-gray-800">Curah Hujan</h2>
            <canvas id="chartHujan"></canvas>
          </div>
        </div>
      </div>
      <div id="histori" class="hidden">
        <div class="p-6 bg-white rounded-2xl shadow-lg">
          <h2 class="text-lg font-semibold mb-4 text-gray-800 tracking-tight">Histori Data Sensor</h2>
          <div class="flex justify-center mb-4">
            <div class="flex items-center gap-3 bg-white px-5 py-3 rounded-2xl shadow-sm">
              <input type="date" id="startDate" class="rounded-xl border px-3 py-2 text-sm text-gray-700">
              <span class="text-gray-400 text-sm">—</span>
              <input type="date" id="endDate" class="rounded-xl border px-3 py-2 text-sm text-gray-700">
              <button id="downloadCsvBtn" class="ml-4 rounded-xl bg-blue-100 text-blue-600 px-3 py-2 text-sm font-semibold">Unduh Data</button>
            </div>
          </div>
          <div class="overflow-x-auto rounded-2xl border border-gray-200">
            <table class="min-w-full border-collapse">
              <thead>
                <tr class="bg-gray-50 text-gray-700 text-sm tracking-wide">
                  <th class="px-4 py-2">Waktu</th>
                  <th class="px-4 py-2">Suhu Mono</th>
                  <th class="px-4 py-2">RH Mono</th>
                  <th class="px-4 py-2">Suhu Poly</th>
                  <th class="px-4 py-2">RH Poly</th>
                  <th class="px-4 py-2">UV Index</th>
                  <th class="px-4 py-2">UV Intensity</th>
                  <th class="px-4 py-2">Debu</th>
                  <th class="px-4 py-2">Curah Hujan</th>
                  <th class="px-4 py-2">Kecepatan Angin</th>
                  <th class="px-4 py-2">Arah Angin</th>
                  <th class="px-4 py-2">Radiasi Matahari</th>
                </tr>
              </thead>
              <tbody id="data-body" class="text-gray-700 text-sm divide-y divide-gray-200 text-center"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <footer class="mt-auto bg-gray-100 text-gray-700 w-full">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 grid grid-cols-1 md:grid-cols-3 gap-6">
        <div>
          <button class="w-full flex justify-between items-center md:block md:cursor-default"
            onclick="toggleFooter(this)">
            <h3 class="font-bold text-sm text-gray-900">Tentang Kami</h3>
            <span class="md:hidden">+</span>
          </button>
          <ul class="mt-2 space-y-1 text-xs hidden md:block">
            <li><a href="https://untad.ac.id/" target="_blank" class="text-gray-700 hover:underline">Universitas Tadulako</a></li>
            <li><a href="https://fatek.untad.ac.id/" target="_blank" class="text-gray-700 hover:underline">Fakultas Teknik</a></li>
            <li><a href="https://elektro.fatek.untad.ac.id/" target="_blank" class="text-gray-700 hover:underline">Teknik Elektro</a></li>
          </ul>
        </div>
        <div>
          <button class="w-full flex justify-between items-center md:block md:cursor-default"
            onclick="toggleFooter(this)">
            <h3 class="font-bold text-sm text-gray-900">Layanan</h3>
            <span class="md:hidden">+</span>
          </button>
          <ul class="mt-2 space-y-1 text-xs hidden md:block">
            <li>Informasi</li>
            <li>Petunjuk Penggunaan</li>
          </ul>
        </div>
        <div>
          <button class="w-full flex justify-between items-center md:block md:cursor-default"
                  onclick="toggleFooter(this)">
            <h3 class="font-bold text-sm text-gray-900">Kontak</h3>
            <span class="md:hidden">+</span>
          </button>
          <ul class="mt-2 space-y-1 text-xs hidden md:block">
            <li>Email: info@untad.ac.id</li>
            <li>Telp: +62 451 123456</li>
            <li>Alamat: Tondo, Sulawesi Tengah</li>
          </ul>
        </div>
      </div>
      <div class="border-t border-gray-200 py-3 text-center text-sm text-gray-600">
        © 2025 Universitas Tadulako. Semua hak dilindungi.
      </div>
    </footer>
    <script>
    const SUPABASE_URL = "https://bryjpjzvsadfvjwqgwak.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJyeWpwanp2c2FkZnZqd3Fnd2FrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg0MzA0MDUsImV4cCI6MjA3NDAwNjQwNX0.1iWQJhtE02t4JTcutIPkzxmn2qyx-Z7JCKFDQ8itCw8";
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    const dataBody = document.getElementById("data-body");
    const water = document.getElementById("water");
    const valueDisplay = document.getElementById("valueDisplay");
    const radius = 60;
    const circumference = 2 * Math.PI * radius;
    const arcLength = circumference * (260 / 360);
    water.style.strokeDasharray = `${arcLength} ${circumference}`;
    water.style.strokeDashoffset = arcLength;

    const minTemp = 0;
    const maxTemp = 50;

    function setLevel(temp) {
      const percent = ((temp - minTemp) / (maxTemp - minTemp)) * 100;
      const offset = arcLength - (percent / 100) * arcLength;
      water.style.strokeDashoffset = offset;
      valueDisplay.textContent = `${temp.toFixed(1)}°C`;
    }

    function updateDashboard(d) {
      document.getElementById("suhu1").textContent = d.suhu1 + " °C";
      document.getElementById("kelembaban1").textContent = d.kelembaban1 + " %";
      document.getElementById("suhu2").textContent = d.suhu2 + " °C";
      document.getElementById("kelembaban2").textContent = d.kelembaban2 + " %";
      document.getElementById("uv_index").textContent = d.uv_index;
      document.getElementById("uv_intensity").textContent = d.uv_intensity;
      document.getElementById("debu").textContent = d.debu + " µg/m³";
      document.getElementById("curah_hujan").textContent = d.curah_hujan + " mm";
      document.getElementById("kecepatan_angin").textContent = d.kecepatan_angin + " m/s";
      document.getElementById("arah_angin").textContent = d.arah_angin;
      document.getElementById("irradiance").textContent = d.irradiance;
      let rataSuhu = ((d.suhu1 + d.suhu2) / 2).toFixed(1);
      setLevel(parseFloat(rataSuhu));
      let kondisi;
      if (rataSuhu < 18) {kondisi = "Dingin";}
      else if (rataSuhu >= 18 && rataSuhu <= 26) {kondisi = "Normal";}
      else {kondisi = "Panas";}
      document.getElementById("kondisiCuaca").textContent = kondisi;
    }
    function initCharts() {
        if (!window.allCharts) window.allCharts = {};

    const chartConfigs = [
        {id:'chartSuhu', labels:['Suhu 1','Suhu 2'], colors:[[255,99,132],[255,159,64]]},
        {id:'chartKelembaban', labels:['Kelembaban 1','Kelembaban 2'], colors:[[54,162,235],[75,192,192]]},
        {id:'chartUV', labels:['UV Index','UV Intensity'], colors:[[255,206,86],[255,159,64]]},
        {id:'chartAngin', labels:['Kecepatan Angin'], colors:[[75,192,192]]},
        {id:'chartRadiasi', labels:['Irradiance'], colors:[[255,159,64]]},
        {id:'chartDebu', labels:['Debu'], colors:[[153,102,255]]},
        {id:'chartHujan', labels:['Curah Hujan'], colors:[[54,162,235]]}
    ];

    const createGradient = (ctx, r, g, b) => {
        const grad = ctx.createLinearGradient(0, 0 , 0, ctx.canvas.height);
        grad.addColorStop(0, `rgba(${r},${g},${b},0.4)`);
        grad.addColorStop(0.5, `rgba(${r},${g},${b},0.15)`);
        grad.addColorStop(1, `rgba(${r},${g},${b},0)`);
        return grad;
    };

    chartConfigs.forEach(cfg => {
        const ctx = document.getElementById(cfg.id).getContext('2d');
        if (window.allCharts[cfg.id]) window.allCharts[cfg.id].destroy();
        const datasets = cfg.labels.map((label,i) => ({
            label,
            data:[],
            borderColor:`rgb(${cfg.colors[i].join(',')})`,
            backgroundColor:createGradient(ctx,...cfg.colors[i]),
            fill:true,
            tension:0.35, // lebih smooth
            pointRadius:5,
            pointHoverRadius:7,
            pointBackgroundColor:`rgb(${cfg.colors[i].join(',')})`,
            pointHoverBackgroundColor:'#fff',
            borderWidth:3,
            shadowOffsetX:0, // Shadow untuk line (modern)
            shadowOffsetY:4,
            shadowBlur:6,
            shadowColor:`rgba(0,0,0,0.1)`
        }));

        window.allCharts[cfg.id] = new Chart(ctx,{
        type:'line',
        data:{labels:[], datasets},
        options:{
            responsive:true,
            interaction:{mode:'index',intersect:false},
            plugins:{
                legend:{position:'top', labels:{boxWidth:12, padding:15, usePointStyle:true}},
                    tooltip:{
                        backgroundColor:'rgba(0,0,0,0.7)',
                        titleColor:'#fff',
                        bodyColor:'#fff',
                        padding:10,
                        cornerRadius:8
                    }
                },
                scales:{
                    x:{grid:{display:false}, ticks:{color:'#666', padding:10}},
                    y:{grid:{color:'rgba(200,200,200,0.1)'}, ticks:{color:'#666', padding:10}}
                }
            }
        });
    });
}
    function arahAnginToRadian(text) {
  const map = {
    "Utara": 0,
    "Timur Laut": 45,
    "Timur": 90,
    "Tenggara": 135,
    "Selatan": 180,
    "Barat Daya": 225,
    "Barat": 270,
    "Barat Laut": 315
  };
  const deg = map[text] !== undefined ? map[text] : 0;
  return deg * Math.PI / 180; // hasil radian
}

    function updateAllCharts(entry){
    const timeLabel = new Date(entry.timestamp).toLocaleTimeString('id-ID');

    const charts = [
        {chart:window.allCharts['chartSuhu'], values:[parseFloat(entry.suhu1), parseFloat(entry.suhu2)]},
        {chart:window.allCharts['chartKelembaban'], values:[parseFloat(entry.kelembaban1), parseFloat(entry.kelembaban2)]},
        {chart:window.allCharts['chartUV'], values:[parseFloat(entry.uv_index), parseFloat(entry.uv_intensity)]},
        {chart:window.allCharts['chartAngin'], values:[parseFloat(entry.kecepatan_angin)]},
        {chart:window.allCharts['chartRadiasi'], values:[parseFloat(entry.irradiance)]},
        {chart:window.allCharts['chartDebu'], values:[parseFloat(entry.debu)]},
        {chart:window.allCharts['chartHujan'], values:[parseFloat(entry.curah_hujan)]}
    ];

    charts.forEach(c=>{
        if(c.chart.data.labels.length>=10){
        c.chart.data.labels.shift();
        c.chart.data.datasets.forEach((ds,i)=>{
            if(c.values[i]!==undefined) ds.data.shift();
        });
        }
        if(c.chart.data.labels.length<10) c.chart.data.labels.push(timeLabel);
        c.chart.data.datasets.forEach((ds,i)=>{
        if(c.values[i]!==undefined) ds.data.push(c.values[i]);
        });
        c.chart.update();
    });

      const compass = document.getElementById('compass');
    if(compass){
        const ctx = compass.getContext('2d');
        const angle = arahAnginToRadian(entry.arah_angin);
        const center = 180;
        ctx.clearRect(0,0,360,360);
        ctx.beginPath();
        ctx.arc(center,center,150,0,2*Math.PI);
        ctx.strokeStyle="#bbb";
        ctx.lineWidth=2;
        ctx.shadowColor='rgba(0,0,0,0.05)';
        ctx.shadowBlur=15;
        ctx.stroke();

        const directions = ['U','TL','T','TG','S','BD','B','BL'];
        directions.forEach((dir,i)=>{
            const dirAngle = i * 45 * Math.PI/180;
            const x = center + (150+20) * Math.cos(dirAngle - Math.PI/2);
            const y = center + (150+20) * Math.sin(dirAngle - Math.PI/2);
            ctx.fillStyle="#333";
            ctx.font="bold 14px 'Arial', sans-serif";
            ctx.textAlign="center";
            ctx.textBaseline="middle";
            ctx.fillText(dir,x,y);
        });

        ctx.beginPath();
        ctx.moveTo(center,center);
        ctx.lineTo(center+120*Math.cos(angle-Math.PI/2), center+120*Math.sin(angle-Math.PI/2));
        ctx.strokeStyle = '#ff4d4f';
        ctx.lineWidth = 8;
        ctx.lineCap = 'round';
        ctx.shadowColor = 'rgba(255,77,79,0.4)';
        ctx.shadowBlur = 15;
        ctx.stroke();
        ctx.beginPath();
        ctx.arc(center, center, 12, 0, 2*Math.PI);
        ctx.fillStyle = '#ff4d4f';
        ctx.shadowBlur = 10;
        ctx.shadowColor = 'rgba(0,0,0,0.2)';
        ctx.fill();
        ctx.moveTo(center, center);
        ctx.lineTo(center + 120*Math.cos(angle-Math.PI/2), center + 120*Math.sin(angle-Math.PI/2));
      ctx.stroke()
        document.getElementById('chartArahAngin').textContent = `Arah: ${entry.arah_angin}`;
    }
    }

    function formatRow(d) {
      return `
        <tr class="bg-white">
          <td class="border px-2 py-1">${d.waktu}</td>
          <td class="border px-2 py-1">${d.suhu1}</td>
          <td class="border px-2 py-1">${d.kelembaban1}</td>
          <td class="border px-2 py-1">${d.suhu2}</td>
          <td class="border px-2 py-1">${d.kelembaban2}</td>
          <td class="border px-2 py-1">${d.uv_index}</td>
          <td class="border px-2 py-1">${d.uv_intensity}</td>
          <td class="border px-2 py-1">${d.debu}</td>
          <td class="border px-2 py-1">${d.curah_hujan}</td>
          <td class="border px-2 py-1">${d.kecepatan_angin}</td>
          <td class="border px-2 py-1">${d.arah_angin}</td>
          <td class="border px-2 py-1">${d.irradiance}</td>
        </tr>
      `;
    }
    
    async function loadData() {
      const { data, error } = await supabaseClient
        .from('sensor_data')
        .select('*')
        .order('timestamp', { ascending: false })
        .limit(20);
      if (error) { console.error("Error loading data:", error); return; }
      dataBody.innerHTML = data.map(d => formatRow(d)).join("");
      if (data.length) updateDashboard(data[0]);
      data.forEach(updateAllCharts);
    }
    
    supabaseClient.channel('sensor-realtime')
      .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'sensor_data' }, payload => {
        const entry = payload.new;
        updateAllCharts(entry);
        const tr = document.createElement("tr");
        tr.innerHTML = formatRow(entry);
        tr.classList.add("new-entry");
        dataBody.prepend(tr);
        setTimeout(() => tr.classList.remove("new-entry"), 5000);
        while (dataBody.rows.length > 50) dataBody.removeChild(dataBody.lastChild);
        updateDashboard(entry);
    }).subscribe();
      initCharts();
      loadData();
    function updateClock() {
      const now = new Date();
      const options = { hour: '2-digit', minute: '2-digit', second: '2-digit' };
      document.getElementById('clock').textContent = now.toLocaleTimeString('id-ID', options);
    }
    setInterval(updateClock, 1000);
    updateClock();
    
    function showPage(page, el) {
      ["utama", "grafik", "histori"].forEach(id => document.getElementById(id).classList.add("hidden"));
      document.getElementById(page).classList.remove("hidden");
      document.querySelectorAll(".nav-link").forEach(btn => {
        btn.classList.remove("text-blue-600", "font-semibold", "border-b-2", "border-blue-600");
        btn.classList.add("text-gray-600");
      });
      if (el) {
        el.classList.remove("text-gray-600");
        el.classList.add("text-blue-600", "font-semibold", "border-b-2", "border-blue-600");
      }
      adjustContentOffset();
    }
    
    document.addEventListener("DOMContentLoaded", () => {
      const menuBtn = document.getElementById("menuBtn");
      const mobileMenu = document.getElementById("mobileMenu");
      if (menuBtn) menuBtn.addEventListener("click", () => mobileMenu.classList.toggle("hidden"));
      renderHistori();
    });
    
    function adjustContentOffset() {
      const header = document.querySelector("header");
      const pages = document.querySelectorAll("#utama, #grafik, #histori");
      if (header) {
        const offset = header.offsetHeight + 10;
        pages.forEach(page => page.style.paddingTop = offset + "px");
      }
    }
    window.addEventListener("load", adjustContentOffset);
    window.addEventListener("resize", adjustContentOffset);
    
    
  </script>
    <script>
      function toggleFooter(button) {
        const list = button.nextElementSibling;
        if (!list) return;
        list.classList.toggle("hidden");
        // ubah tanda + jadi -
        const icon = button.querySelector("span");
        if (icon) {
          icon.textContent = list.classList.contains("hidden") ? "+" : "−";
        }
      }
    </script>
</body>
</html>
